# springstudy
스프링에 대해 학습하면서 정리하는 개인 Repo

## 멀티쓰레드에 대해
### 왜 써야해?
인터페이스의 파라미터 값을 변경해 각각의 log 정보를 남긴다면 매우 비효율적인 과정이고 이를 해결하기 위해
LogTrace 필드를 활용해 이를 호출함으로써 인터페이스 변경없이 처리한다.
하지만 이는 동시에 여러 요청이 들어온 케이스에 대해 처리할 수 없다. <br>
LogTrace는 싱글톤객체이기때문에 해당 빈이 공유되어버리는 문제가 발생한다.
이를 해결하기 위해 ThreadLocal을 사용한다.
ThreadLocal은 각각의 Thread에 대해 독립적인 데이터 저장소를 사용할 수 있어서 A사용자의 요청 정보가
B사용자의 로그에 노출되어질 일이 없어진다.

### 주의사항
ThreadLocal 사용 시 전용 저장소에 각각의 thread의 정보를 저장한 뒤 WAS가 응답한다.
WAS는 thread pool을 쓰레드 풀에 반환하고 재사용한다.
만약 thread-A가 살아있다면 사용자 A의 정보도 그대로 남아있다.
이후 사용자 B가 조회하는 API를 요청했고 하필 쓰레드 A에서 처리한다면 쓰레드 A가 저장했었던
사용자 A의 정보가 반환되서 사용자B는 사용자A의 정보를 보게된다.

그러므로 HTTP 요청이 끝날 때 Thread Local의 값을 remove를 통해 꼭 제거해줘야한다.